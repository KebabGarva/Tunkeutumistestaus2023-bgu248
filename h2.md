# Scanning Cyberspace _by Saku Laitinen_

## Sisällysluettelo

- **[Johdanto](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h2.md#Johdanto)**
- **[Lämmittelytehtävä](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h2.md#Lämmittelytehtävä)**
- **[Luodaan Vagrantilla kaksi virtuaalikonetta ja niiden välinen verkko](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h2.md#Luodaan-Vagrantilla-kaksi-virtuaalikonetta-ja-niiden-välinen-verkko)**

## Johdanto

### Mitä?

Tämä raportti on tehty Tero Karvisen toteuttaman kurssin [Tunkeutumistestaus](https://terokarvinen.com/2024/eettinen-hakkerointi-2024/) yhteydessä. Tämä raportti kertoo läpikohtaisesti, mitä tein tehtävän h2 eteen.
Sisällysluettelon linkkejä painamalla pystyy navigoimaan suoraan haluttuun kohtaan.

### Missä?

Toteutin tehtäviin liittyvät komennot fyysisessä Windows 11 - ja virtuaalisissa Kali-ympäristöissä hyödyntämällä [Virtualboxia](https://www.virtualbox.org/) ja [Vagrantia](https://developer.hashicorp.com/vagrant).
Spesifoin tarkemmin kappaleen alussa, mitkä ovat käytettävän/käytettävien käyttöjärjestelmien tiedot. Kaikki komennot ovat toteutettu Linux-virtuaaliympäristössä. 

**Tietokoneet**

[*Fyysinen kone: Lenovo Legion 7 16ACHg6*](https://nanoreview.net/en/laptop/lenovo-legion-7-2021-amd?m=c.1_g.3_r.3_s.3)
[Vagrant: kalilinux/rolling](https://app.vagrantup.com/kalilinux/boxes/rolling)
[Vagrant: ProfessionallyEvil/metasploitable2](https://app.vagrantup.com/ProfessionallyEvil/boxes/metasploitable2)


### Milloin?

Testit ja oikoluku suoritettiin 12.4.

## Lämmittelytehtävä

<details>

<summary>a)</summary>

### Porttiskanneri nmap:n perusteet

- Nmap <kohde> -komennolla skannataan 1000 yleisintä TCP-porttia.
- Nmap jakaa portit kuuteen tilaan:
  - auki
    - sovellus hyväksyy aktiivisesti TCP-, UDP, tai SCTP-yhteyksiä kyseisessä portissa.
    - hakkeroinnin näkökulmasta kyseinen portti voi olla hyväksikäytön uhri
  - suljettu
    - vaikka kyseinen portti vastaa nmapin pyyntöön, portti ei ole auki
    - on syytä skannata myöhemmin
  - suodatettu
    - portti on suodatettu palomuurilaitteen, reitittimen sääntöjen tai päätelaitteen virustorjuntaohjelmiston vuoksi
    - merkki hyvin haastavasta porttiskannattavasta portista, koska kyseiset portit tarjoavat hyvin puutteelista tietoa
    - nmap varmistaa useita kertoja, johtuuko tila mahdollisesta pudotetusta paketista
  - suodattamaton
    - portti on saavutettava, mutta nmap ei pysty määrittämään portin aukiolotilasta.
    - ainoastaan ACK-skannauksen tulos voi palauttaa kyseisen arvon
    - eri skannaustyypit kuin Windows-, SYN - tai FIN -skannaus voi antaa parempaa tilannekuvaa portin aukiolosta 
  -  auki tai suodatettu
    - kyseinen tila asetetaan ainoastaan silloin, kun nmap ei tiedä, onko portti auki vai suodatettu.
    - voi johtua myös tiputetusta nmapin koettimen tai minkä tahansa muun vastauksen takia
  - kiinni tai suodatettu
    - sama kuin edellinen tila, mutta nmap ei tiedä onko portti kiinni vai suodatettu.
- Nmapilla voi suorittaa erilaisia porttiskannauksia
  - -sS (TCP-ja SYN-skannaus)
    - kaikista suosituin porttiskannaustekniikka
    - sen voi suorittaa nopeasti skannaten potentiaalisesti tuhanseja portteja sekunnissa
    - ei suorita kokonaan kättelyä, vaan lähettää pelkästään SYN -lipulla olevan paketin
  - -sT (TCP-yhteysskannaus)
    - tämä on oletusskannaustekniikka, jos SYN-skannaus ei ole vaihtoehto
    - korkean tason järjestelmäkutsu, jota selaimet, P2P -päätelaitteet ja muut verkkpalvelut käyttävät
  - -sU (UDP-skannaus)
    - tarkistaa UDP-palvelujen portit
    - voi yhdistää -sS -skannaukseen.
    - haastavaa on tehdä skannaus nopeasti
   
Nmap: Port Scanning Basics, luettu 12.4.2024: https://nmap.org/book/man-port-scanning-basics.html
Nmap: Port Scanning Techniques, luettu 12.4.2024: https://nmap.org/book/man-port-scanning-techniques.html

</details>

<details>

  <summary>b)</summary>

  ### Nuoren 17-vuotiaan tekemä porttiskannaus OPK -osuuskunnan tietojärjestelmään
  - Nuori on toteuttanut porttiskannauksen 23.11.1998.
    - Avoimia portteja ei löytynyt
    - Nuorta syytetään tietomurron yrityksestä
  - Nuori joutui korvaamaan tietomurron aiheuttamat "vahingot"
    - Syyttäjän vaatima korvaussumma oli 100 000 MK
    - Käräjänoikeuden tuomiossa 29.2.2000 määrättiin nuoren maksamaan sakkoja rikoksesta tietoliikenteen häiriö sakkorangaistukseen
    - Syyttäjä valitti hovioikeuteen, ja hovioikeus tuomitsi nuoren maksamaan sakkojen lisäksi syyttäjille yhteensä 75 000 MK.
    - Epäilty valitti korkeimmalle oikeudelle, ja tuomiolauselman mukaan hovioikeuden tuomion lopputulosta ei muuteta.
  - Tuomio on esimerkki huonosti päättyneestä porttiskannauskokeilusta.
    - Porttiskannauksia tehdään ainoastaan luvalla
    - Pitää varmistaa, onko yhteys muualle kuin haluamaansa kohteeseen.
</details>

## Luodaan Vagrantilla kaksi virtuaalikonetta ja niiden välinen verkko

**Käyttöjärjestelmät: Windows 11 Pro For Workstations, Kali 2024.1 ja**

Käytän Vagrantia tähän, koska se on yksinkertaisesti kaikista paras mahdollinen tapa luoda uusia virtuaalikoneita ja niiden välistä verkkoa. Siinä käytetään ***YHTÄ (1)*** VagrantFile -konfiguraatiotiedostoa. Minulla oli jo valmiiksi tyhjä VagrantFile-tiedosto omassa kansiossaan. Tyhjän VagrantFilen saa helposti toteuttamalla `vagrant up` -komennon haluamassaan kansiossaan. Määritin seuraavaksi Notepad++:lla VagrantFilen.

```
# -*- mode: ruby -*-
# vi: set ft=ruby :
# Copyright 2024 Saku Laitinen https://github.com/KebabGarva/

$tscript = <<TSCRIPT
echo "running apt-get update aww yea"
apt-get update
echo "Okay, let's do this - https://github.com/KebabGarva/"
TSCRIPT

Vagrant.configure("2") do |config|
	config.vm.synced_folder ".", "/vagrant", disabled: true
	config.vm.synced_folder "shared/", "/home/vagrant/shared", create: true
	config.vm.provision "shell", inline: $tscript

	config.vm.define "s001" do |s001|
		s001.vm.hostname = "s001"
		s001.vm.network "private_network", ip: "192.168.88.101"
		s001.vm.box = "kalilinux/rolling"
	end

	config.vm.define "s002" do |s002|
		s002.vm.hostname = "s002"
		s002.vm.network "private_network", ip: "192.168.88.102"
		s002.vm.box = "ProfessionallyEvil/metasploitable2"
	end
	
end
```

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/2f282c0d-321f-4bd3-a38c-92467de4ffeb)

Ainoastaan toimivan Metasploitable 2 -Vagrantboxin löytämisessä meni paljon aikaa. Huokaisin helpotuksesta, kun virtuaalikoneet toimivat haluamalla tavallani.

```
vagrant up
```
![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/3a3bd2e9-ee67-4085-a7ac-421708372fc1)

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/a3301351-8d37-45c2-bcbf-e3a39a99c3b6)

Halusin tarkistaa, onko yhteys muodostettu virtuaalikoneiden välille. Halusin myös varmistaa käyttäväni bashia. Yhdistin seuraavaksi koneeseen s001 seuraavasti:

```
vagrant ssh s001
bash
```
![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/9919b38b-4101-4522-b740-82f57fe160f9)

Tämän jälkeen tarkistin yhteyden.

```
ping 192.168.88.102
```

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/95ba5ace-68d2-4fb7-a77e-8497dfbff53c)

Se ei onnistunut, koska paketteja ei tullut takaisin. 

Kali on kuitenkin yhdistänyt internetiin.

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/1d21bf67-9ad1-41c2-946e-d2e2a92b1ed2)


Kokeilin tämän jälkeen katsoa vinkkejä, miten voin saada yhteyden konfiguroitua tietokoneiden välille. Hashicorpin foorumilla törmäsin yksittäisen käyttäjän mikehenrtyn huomioon, että ainakin VirtualBox 6.1.28:ssa on rajallinen määrä ip-osoitteita virtuaaliseen päätelaiteverkkoon. (Klikkaa [tästä](https://discuss.hashicorp.com/t/vagran-can-not-assign-ip-address-to-virtualbox-machine/30930/7) päästäksesi artikkeliin)

Konfiguroin uudelleen IP-osoitteet.

```
ip: "192.168.56.101"
ip: "192.168.56.102"
```









