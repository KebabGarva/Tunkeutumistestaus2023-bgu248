# Scanning Cyberspace _by Saku Laitinen_

## Sisällysluettelo

- **[Johdanto](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/edit/main/h5.md#johdanto)**
- **[Lämmittelytehtävä](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h5.md#Lämmittelytehtävä)**
- **[Luvattoman sertifikaatin generointi](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h5.md#luvattoman-sertifikaatin-generointi)**
- **[Foxyproxy ja ZAP](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h5.md#foxyproxy-ja-zap)**
- **[Portswigger Labs -tehtävät](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h5.md#Portswigger-Labs--tehtävät)**
- **[WebGoat-tehtäviä](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h5.md#WebGoat-tehtäviä)**
- **[pencode](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/blob/main/h5.md#pencode)**

## Johdanto

### Mitä?

Tämä raportti on tehty Tero Karvisen toteuttaman kurssin [Tunkeutumistestaus](https://terokarvinen.com/2024/eettinen-hakkerointi-2024/) yhteydessä.
Tämä raportti kertoo läpikohtaisesti, mitä tein tehtävän **h5** eteen.
Sisällysluettelon linkkejä painamalla pystyy navigoimaan suoraan haluttuun kohtaan.

### Missä?

Toteutin tehtäviin liittyvät komennot fyysisessä Windows 11 - ja virtuaalisessa Kali-ympäristöissä hyödyntämällä [Virtualboxia](https://www.virtualbox.org/) ja [Vagrantia](https://developer.hashicorp.com/vagrant).
Spesifoin tarkemmin kappaleen alussa, mitkä ovat käytettävän/käytettävien käyttöjärjestelmien tiedot. 

**Tietokoneet**

- [*Fyysinen kone: Lenovo Legion 7 16ACHg6*](https://nanoreview.net/en/laptop/lenovo-legion-7-2021-amd?m=c.1_g.3_r.3_s.3)
- [Vagrant: kalilinux/rolling](https://app.vagrantup.com/kalilinux/boxes/rolling)

**Käyttämäni Vagrantfile**

```
 -*- mode: ruby -*-
# vi: set ft=ruby :
# Copyright 2024 Saku Laitinen https://github.com/KebabGarva/

$tscript = <<TSCRIPT
echo "running apt-get update aww yea"
apt-get update
echo "Okay, let's do this - https://github.com/KebabGarva/"
TSCRIPT

Vagrant.configure("2") do |config|
	config.vm.synced_folder ".", "/vagrant", disabled: true
	config.vm.synced_folder "shared/", "/home/vagrant/shared", create: true
	config.vm.provision "shell", inline: $tscript

	config.vm.define "s001" do |s001|
		s001.vm.hostname = "hackerman"
		s001.vm.network "private_network", ip: "192.168.56.101"
		s001.vm.box = "kalilinux/rolling"
		s001.vm.provider "virtualbox" do |vb|
			vb.memory = 8192
			vb.cpus = 4
		end
	end

	config.vm.define "s002" do |s002|
		s002.vm.hostname = "s002"
		s002.vm.network "private_network", ip: "192.168.56.102"
		s002.vm.box = "debian/bullseye64"
	end
	
end
```



## Milloin?

Tehtävät tehtiin 3.5. - 4.5. välisenä aikana.

## Lämmittelytehtävä

<details>

<summary>OWASP 2021 A01 & A10</summary>

### A01: Broken Access Control

- Kulunvalvonnan haavoittuvuus, joka tyypillisesti johtaa luvattomaan tietojen luovuttamiseen, muuttamiseen tai tuhoamiseen.
- Konkreettiset esimerkit haavoittuvasta kulunvalvonnat ovat esimerkiksi
  - Järjestelmää hallinnoivien ominaisuuksien myöntäminen liian kevyin perustein
  - URL-osoitteen muokkaaminen tai API-pyyntöjä muokkaavan hyökkäyksen käyttäminen
  - toisen tilin katselu tai muokkaamisen salliminen hyödyntämällä annettua yksilöllistä tunnusta
  - POST-, PUT- ja DELELTE -käyttöoikeuksien puuttuminen API:sta
  - etuoikeuksien korottamista esittämällä olevan kirjautunut tai toimivan järjestelmänvalvojana
  - Metatietojen, kuten JWT (JSON Web Token) -käyttöoikeustunnisteen manipulointi .
  - CORS (Cross-origin resource sharing) virheellinen määrittäminen johtaa luvattomaan API-pääsyyn luottamattomista lähteistä.
  - pakottamalla sivun antamaan pääsyn sivulla todentamattomalla käyttäjällä
 
https://owasp.org/Top10/A01_2021-Broken_Access_Control/
  
### A10: Server-Side Request Forgery (SSRF)

- SSRF-virhe ilmaantuu silloin, kun verkkosovellus hakee etäresursseja todentamatta käyttäjän toimittamaa URL -osoitetta.
  - Hyökkääjä voi virhettä hyväksikäyttämällä pakottaa verkkosovelluksen palauttamaan tietoja yrityksen sisäverkosta viallisen internettiin yhdistetyn palvelimen kautta.
- Kyseistä haavoittuvuutta käyttävät hyökkäykset yleistyvät kovaa vauhtia johtuen pilvipalveluihin laajasta siirtymisestä ja verkkojen arkkitehtuurien monimutkaistumisesta. 

https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/

</details>

<details>

<summary>PortSwigger Academy -poiminnat</summary>

### Insecure direct object references (IDOR)

- Yksinkertaisimmillaan hyökkääjä muokkaa URL-osoitetta niin, että hän pääsee suoraan käsiksi haluamaan luvattomaan tiedostoon.
- Käytännössä koneen tietoja pääsee muokkaamaan suoraan internetistä.

https://portswigger.net/web-security/access-control/idor

### Path traversal
  
- Hyödyntää haavoittuvuutta HTML-protokollassa
  - Jos hyökkääjän pyyntöä ei validoida, hän voi pahimassa tapauksessa päästä tietokoneen salasanatiedostoihin käsiksi muokkaamalla ainoastaan URL-osoitetta.

https://portswigger.net/web-security/file-path-traversal

### Server-side template injection

- Hyökkääjä injektoi haittaohjelman, joka toteutetaan palvelinpuolella, verkkosivujen pohjan generoimismoottoriin
- Hyökkäysstä on vaikea havaita, koska hyökkääjä piilottaa dataa verkkosivujen pohjiin piilottaakseen datankäsittelyä.
  - Kyseiset injektiot toteutetaan ulkopuolelta, mutta pyyntöjä käsitellään palvelinpuolella 
  - Haittaohjelma voi pahimassa tapauksessa saada täyden hallinnan palvelimesta, koska hyökkääjä voi mielivaltaisesti komentaa mallimoottorin generoimaan hänelle pääsyoikeudet.
 
https://portswigger.net/web-security/server-side-template-injection

### Cross-site scripting (XSS)

- Hyökkääjä muokkaa esimerkiksi HTTP-pyyntöä toteuttamaan skriptin uhrin koneella.
  - Hyökkääjä lähettää uhrille muokatun URL-osoitteen, joka sisältää toteutettavan skriptin, joka komentaa käyttäjän selaimen esimerkiksi toteuttamaan haitallisen skriptin, joka ladataan toiselta palvelimelta.
 
https://portswigger.net/web-security/cross-site-scripting
  
</details>


## Luvattoman sertifikaatin generointi

Loin koneen Vagrantilla, ja yhdistin sitä kautta SSH-yhteydellä Kali-virtuaalikoneeseen.

```
vagrant up
vagrant ssh s001
```
Tajusin välittömästi, että haluaisin mieluummin käyttää Kalin graafista käyttöliittymää. Komentokehotteen kautta asennus onnistuu, joten asensin OWASP ZAP:n seuraavasti.

```
sudo apt-get install zaproxy
```

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/159fad5e-9dbb-42cc-a793-680f460e23ba)

Siirryin graafiseen käyttöliittymään. 


Käynnistin ZAP:n, ja lähdin generoimaan uutta CA-sertifikaattia. Löysin ZAP:n sertifikaattigeneraattorin asetuksista Network -välilehden alla. Asetuksiin pääsin yläpalkin kautta klikkaamalla Tools -painiketta. Sertifikaattigeneraattori sijaitsi Server Certificates -asetuksissa.  Vaikka ZAP generoi automaattisesti uuden sertifikaatin ensimmäisellä sovelluksen avauskerralla, tehtävänanto ohjeisti generoimaan uuden sertifikaatin. Tehtävänanto ei tarkentanut, mikä sertifikaatti pitää generoida, joten generoin Root CA -sertifikaatin uudelleen.

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/d1914fdf-f16c-4dea-ae8f-810ddb9ad3de)


## Foxyproxy ja ZAP

Tarvitsemme Foxyproxyn, jotta voimme käyttää ZAP -välimiesproxya kohdistamaan hyökkäyksensä ainoastaan virtuaalikoneen loopback -osoitteeseen. Olisin voinut lähteä tekemään näitä skannauksia toiseen virtuaalikoneeseen samassa verkossa, mutta yksinkertaisinta ja järkevintä on tehdä näitä skannauksia aluksi loopbackina. Tämä käytäntö on hyvin yleinen monissa eri verkkoon liittyvissä asioissa. Tätä kirjoittaessa pohdin mahdollisuutta tehdä skannauksia toiseen koneeseen, mutta pöytäsin sen toistaiseksi.

Foxyproxy Standard Editionin kävin lisäämässä Firefoxiin selaamalla Firefox Add-ons -verkkosivulle. (Klikkaa [tästä](https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/) ladataksesi itse Foxyproxyn)  

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/669682f4-28c1-45a1-84f5-037b4c5f8d29)

Tämän jälkeen oli hyvin yksinkertaista konfiguroida Foxyproxy tehtävien tekemiseen. Loin uuden proxyn Foxyproxyn asetuksien kautta. Pääsin luomaan ZAP -proxyn "Proxies" -välilehdellä. Annoin nimeksi ZAP, käytin hostnamena loopback-osoitetta ja määritin sen toimimaan portille 8080.


![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/4b775dfa-dddc-4a43-8cad-c2229f3b0acc)

Menin varmistamaan ZAP:sta, että ZAP on määritetty toimimaan Foxyproxyn kautta.

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/599b3618-46a1-405b-9793-cc6a8eeed32b)

Tämän jälkeen toin ZAP:n sertifikaatin Firefox -selaimeen navigoimalla Firefoxin asetuksiin ja sitä kautta tietoturvasetuksiin. Klikkasin auki "View Sertificates". Lisäsin Authorities -välilehden kautta sertifikaatin klikkaamalla "Import". Tajusin välittömästi, että minulta unohtui tallentaa sertifikaatti cer-tiedostoksi. Kävin ZAP:n puolella tallentamassa sen kotihakemistoon klikkaamalla "save". Tiedosto on tallennettu nimellä `zap_root_ca.cer`

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/a33f5d13-391b-4439-8b4f-7152cb05b313)

Siirryin Firefoxiin takaisin lisäämään sertifikaatin. 

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/c28e15d1-1426-489e-9507-cb29135394c1)

Testasin proxyn yhdistämällä google.com

![image](https://github.com/KebabGarva/Tunkeutumistestaus2024-bgu248/assets/89390996/04660756-1ca6-4667-96f8-47eba33edcc7)


## Portswigger Labs -tehtävät


## WebGoat-tehtäviä


## pencode

